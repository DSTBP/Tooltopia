<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flight Out - 高难度随机版</title>
    <link rel="icon" href="favicon.png">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="fo-container">
        <header class="fo-header">
            <h1>Flight Out - 高难度随机版</h1>
            <p class="fo-sub">更大棋盘与更高密度随机初始状态</p>
            <p><a class="fo-btn" href="variant.html">返回变体中心</a></p>
        </header>

        <section class="fo-panel">
            <div class="fo-left">
                <div class="fo-controls">
                    <div class="fo-row">
                        <label>行 <input type="number" id="rowsInput" min="5" max="20" value="10"></label>
                        <label>列 <input type="number" id="colsInput" min="5" max="20" value="10"></label>
                    </div>
                    <div class="fo-row">
                        <button id="shuffle" class="fo-btn fo-primary">随机生成</button>
                        <button id="reset" class="fo-btn">清空</button>
                        <button id="undo" class="fo-btn" disabled>撤销</button>
                    </div>
                    <div class="fo-stats">
                        <span>步数：<b id="moveCount">0</b></span>
                        <span id="statusText"></span>
                    </div>
                </div>
            </div>
            <div class="fo-board-wrap">
                <div id="board" class="fo-board" role="grid"></div>
            </div>
        </section>
    </div>

    <script src="assets/js/solve.js"></script>
    <script>
    (function(){
        const boardEl = document.getElementById('board');
        const rowsInput = document.getElementById('rowsInput');
        const colsInput = document.getElementById('colsInput');
        const shuffleBtn = document.getElementById('shuffle');
        const resetBtn = document.getElementById('reset');
        const undoBtn = document.getElementById('undo');
        const moveCountEl = document.getElementById('moveCount');
        const statusText = document.getElementById('statusText');

        let rows = 10, cols = 10;
        let grid = createMatrix(rows, cols, 0);
        let moveCount = 0;
        let undoStack = [];

        function createMatrix(r, c, fill){
            return Array.from({length:r}, () => Array.from({length:c}, () => fill|0));
        }
        function render(){
            boardEl.innerHTML = '';
            boardEl.style.setProperty('--rows', String(rows));
            boardEl.style.setProperty('--cols', String(cols));
            for(let r=0;r<rows;r++){
                for(let c=0;c<cols;c++){
                    const cell = document.createElement('button');
                    cell.className = 'fo-cell'+(grid[r][c]? ' on':'' );
                    cell.dataset.r = String(r);
                    cell.dataset.c = String(c);
                    boardEl.appendChild(cell);
                }
            }
            moveCountEl.textContent = String(moveCount);
            undoBtn.disabled = undoStack.length===0;
            statusText.textContent='';
        }
        function inBounds(r,c){ return r>=0 && r<rows && c>=0 && c<cols; }
        function applyFlip(r,c){
            const idx = [[0,0],[1,0],[-1,0],[0,1],[0,-1]];
            for(const [dr,dc] of idx){
                const rr=r+dr, cc=c+dc;
                if(inBounds(rr,cc)) grid[rr][cc]^=1;
            }
        }
        function onCellClick(e){
            const t = e.target;
            if(!(t instanceof HTMLElement) || !t.classList.contains('fo-cell')) return;
            const r = parseInt(t.dataset.r,10), c = parseInt(t.dataset.c,10);
            const snapshot = grid.map(row=>row.slice());
            applyFlip(r,c);
            undoStack.push(snapshot);
            moveCount++;
            render();
        }
        function reset(){
            grid = createMatrix(rows, cols, 0);
            moveCount = 0;
            undoStack = [];
            render();
        }
        function undo(){
            if(undoStack.length===0) return;
            grid = undoStack.pop();
            moveCount = Math.max(0, moveCount-1);
            render();
        }
        function onSizeChange(){
            const r = Math.max(5, Math.min(20, parseInt(rowsInput.value||'10',10)||10));
            const c = Math.max(5, Math.min(20, parseInt(colsInput.value||'10',10)||10));
            rows = r; cols = c;
            grid = createMatrix(rows, cols, 0);
            moveCount = 0; undoStack = [];
            render();
        }
        function shuffle(){
            // 高密度：按面积的40%翻转次数生成
            const moves = Math.max(1, Math.round(rows*cols*0.4));
            // 从全亮开始避免退化
            grid = createMatrix(rows, cols, 1);
            for(let k=0;k<moves;k++){
                const r = Math.floor(Math.random()*rows);
                const c = Math.floor(Math.random()*cols);
                applyFlip(r,c);
            }
            moveCount = 0; undoStack = [];
            render();
        }

        boardEl.addEventListener('click', onCellClick);
        resetBtn.addEventListener('click', reset);
        undoBtn.addEventListener('click', undo);
        rowsInput.addEventListener('input', onSizeChange);
        colsInput.addEventListener('input', onSizeChange);
        shuffleBtn.addEventListener('click', shuffle);

        // 初始化
        shuffle();
    })();
    </script>
</body>
</html>


